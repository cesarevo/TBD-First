## <a name="3!!"></a>Многотабличные запросы

1. [Вывести все имена и фамилии студентов, и название хобби, которым занимается этот студент.](#3_1)
2. [Вывести информацию о студенте, занимающимся хобби самое продолжительное время.](#3_2)
3. [Вывести имя, фамилию, номер зачетки и дату рождения для студентов, средний балл которых выше среднего, а сумма риска всех хобби, которыми он занимается в данный момент, больше 0.9.](#3_3)
4. [Вывести фамилию, имя, зачетку, дату рождения, название хобби и длительность в месяцах, для всех завершенных хобби Диапазон дат.](#3_4)
5. [Вывести фамилию, имя, зачетку, дату рождения студентов, которым исполнилось N полных лет на текущую дату, и которые имеют более 1 действующего хобби.](#3_5)
6. [Найти средний балл в каждой группе, учитывая только баллы студентов, которые имеют хотя бы одно действующее хобби.](#3_6)
7. [Найти название, риск, длительность в месяцах самого продолжительного хобби из действующих, указав номер зачетки студента.](#3_7)
8. [Найти все хобби, которыми увлекаются студенты, имеющие максимальный балл.](#3_8)
9. [Найти все действующие хобби, которыми увлекаются троечники 2-го курса.](#3_9)
10. [Найти номера курсов, на которых более 50% студентов имеют более одного действующего хобби.](#3_10)
11. [Вывести номера групп, в которых не менее 60% студентов имеют балл не ниже 4.](#3_11)
12. [Для каждого курса подсчитать количество различных действующих хобби на курсе.](#3_12)
13. [Вывести номер зачётки, фамилию и имя, дату рождения и номер курса для всех отличников, не имеющих хобби. Отсортировать данные по возрастанию в пределах курса по убыванию даты рождения.](#3_13)
14. [Создать представление, в котором отображается вся информация о студентах, которые продолжают заниматься хобби в данный момент и занимаются им как минимум 5 лет.](#3_14)
15. [Для каждого хобби вывести количество людей, которые им занимаются.](#3_15)
16. [Вывести ИД самого популярного хобби.](#3_16)
17. [Вывести всю информацию о студентах, занимающихся самым популярным хобби.](#3_17)
18. [Вывести ИД 3х хобби с максимальным риском.](#3_18)
19. [Вывести 10 студентов, которые занимаются одним (или несколькими) хобби самое продолжительно время.](#3_19)
20. [Вывести номера групп (без повторений), в которых учатся студенты из предыдущего запроса.](#3_20)
21. [Создать представление, которое выводит номер зачетки, имя и фамилию студентов, отсортированных по убыванию среднего балла.](#3_21)
22. [Представление: найти каждое популярное хобби на каждом курсе.](#3_22)
23. [Представление: найти хобби с максимальным риском среди самых распространенных хобби на 2 уровне.](#3_23)
24. [Представление: для каждого курса подбирается количество студентов на курсе и количество отличников.](#3_24)
25. [Представление: самое популярное хобби среди всех студентов.](#3_25)
26. [Создать обновляемое представление.](#3_26)
27. [Для каждой буквы алфавита из числа найденных величин, средних и балльных. (Т.е. среди всех студентов, чьё имя начинается на А (Алексей, Алина, Артур, Анджела) найти то, что указано в задании. Вывести на экран тех, средний балл проходит больше 3,6](#3_27)
28. [Для каждой фамилии характерна высокая степень тяжести и снижение балла. (Например, в университете учатся 4 Иванова (1-2-3-4). 1-2-3 учатся на 2 курсах и имеют средний балл 4.1, 4, 3.8, соответственно, а 4 Иванов учится на 3 курсах и имеет балл 4.5. На экране должно быть следующее:](#3_28)

id | surname | max | min
---|---------|-----|----    
2  | Иванов  | 4,1 | 3,8
3  | Иванов  | 4,5 | 4,5

29. [Для каждого года рождения подсчитывается количество хобби, наблюдаемое или занимавшееся студентами.](#3_29)
30. [Для каждой буквы алфавита в большинстве случаев возникает риск, связанный с хобби.](#3_30)
31. [Для каждого месяца из-за даты рождения студентов получаются средние баллы, которые являются хобби под названием «Футбол».](#3_31)
32. [Вывести информацию о студентах, которые занимались или занимались хотя бы 1 хобби в следующем формате: Имя: Иван, фамилия: Иванов, группа: 1234](#3_32)
33. [Внешний вид в какой-то по счёту символа встречается «ов». Если 0 (т.е. не встречается, то выведите на экран «не найдено»).](#3_33)
34. [Дополнить фамилию прямым символом # до 10 символов.](#3_34)
35. [При помощи функции удалить все символы # из полученного запроса.](#3_35)
36. [Выведите на экран количество дней в прошлом 2018 году.](#3_36)
37. [Вывести на экран какого числа будет ближайшая суббота.](#3_37)
38. [Выведите на экран век, а также какая сейчас неделя года и день года.](#3_38)
39. [Вы вводите всех студентов, которые занимались хотя бы 1 хобби. Выведите на экран Имя, Фамилию, Название хобби, а также надпись «занимается», если студент продолжает заниматься хобби в данный момент или «закончил», если уже не занимается.](#3_39)
40. [Для каждой группы приводят количество студентов учится на 5,4,3,2. Использовать обычное математическое округление. Итоговый результат должен выглядеть примерно так:](#3_40)

    | СЧЕТ | 2222 | 3011 | 4011 | 4032 |
    | ----- | ---- | ---- | ---- | ---- |
    | 2 | 0 | 0 | 0 | 1 |
    | 3 | 1 | 2 | 1 | 1 |
    | 4 | 4 | 3 | 3 | 3 |
    | 5 | 1 | 1 | 1 | 0 |

<br></br>

### <a name="3_1"></a> 1. Вывести все имена и фамилии студентов, и название хобби, которым занимается этот студент.

#### `Запрос`

```SQL

SELECT stud.name, stud.surname, h.hobby_name FROM student stud
INNER JOIN student_hobby sh ON stud.n_z = sh.id
INNER JOIN hobby h ON h.id = sh.id

```

#### `Вывод`

![sql1](https://github.com/cesarevo/TBD-First/blob/08caf77588af0a4d967b873ff7ce90cfb03d9dcc/sql1.png)

<br></br>



<br></br>

### <a name="3_2"></a> 2. Вывести информацию о студенте, занимающимся хобби самое продолжительное время.

#### `Запрос`

```SQL
SELECT (NOW ()-sh.started_at) as doing, *
FROM student stud
INNER JOIN student_hobby sh ON stud.n_z  = sh.student_id
INNER JOIN hobby h ON h.id = sh.hobby_id
WHERE sh.finished_at IS NULL
ORDER BY sh.started_at
LIMIT 1

```

#### `Вывод`

![sql2](sql_pict/sql2.png)

<br></br>

### <a name="3_3"></a> 3. Вывести имя, фамилию, номер зачетки и дату рождения для студентов, средний балл которых выше среднего, а сумма риска всех хобби, которыми он занимается в данный момент, больше 9.

#### `Запрос`

```SQL
SELECT stud.name, stud.surname, stud.n_z, stud.age
FROM student stud LEFT JOIN (
SELECT student_id, SUM(risk) FROM student_hobby sh
JOIN hobby h on sh.hobby_id = h.id
GROUP BY student_id) as nt 
ON stud.id=nt.student_id
WHERE stud.score>= (select AVG(score) FROM student) and nt.sum>9
```

#### `Вывод`

![sql3](sql_pict/sql3.png)

<br></br>

### <a name="3_4"></a> 4. Вывести фамилию, имя, зачетку, дату рождения, название хобби и длительность в месяцах, для всех завершенных хобби Диапазон дат.

#### `Запрос`

```SQL
SELECT stud.surname, stud.name, stud.n_z, stud.age  FROM student stud;
SELECT h.hobby_name FROM hobby h;

SELECT (sh.finished_at - sh.started_at)/30 as doing
FROM student stud
INNER JOIN student_hobby sh ON stud.n_z = sh.student_id
INNER JOIN hobby h ON h.id = sh.hobby_id
```

#### `Вывод`

![sql4](sql_pict/sql4.png)

<br></br>

### <a name="3_5"></a> 5. Вывести фамилию, имя, зачетку, дату рождения студентов, которым исполнилось N полных лет на текущую дату, и которые имеют более 1 действующего хобби.

#### `Запрос`

```SQL
SELECT stud.surname, stud.name, stud.n_z, stud.age
FROM student stud 
Inner JOIN (
SELECT student_id, (count(sh.started_at)-count(sh.finished_at)) as counter
FROM student_hobby sh
JOIN hobby h on sh.hobby_id = h.id
GROUP BY student_id) as nt 
ON stud.n_z=nt.student_id
WHERE stud.age>19 and nt.counter>1

```

#### `Вывод`

![sql5](sql_pict/sql5.png)

<br></br>

### <a name="3_6"></a> 6. Найти средний балл в каждой группе, учитывая только баллы студентов, которые имеют хотя бы одно действующее хобби.

#### `Запрос`

```SQL
SELECT stud.n_group, AVG(stud.score)
FROM student stud
INNER JOIN student_hobby sh on stud.n_z=sh.student_id
WHERE sh.finished_at IS NULL and sh.started_at IS NOT NULL
GROUP BY stud.n_group

```

#### `Вывод`

![sql6](sql_pict/sql6.png)

<br></br>

### <a name="3_7"></a> 7. Найти название, риск, длительность в месяцах самого продолжительного хобби из действующих, указав номер зачетки студента.

#### `Запрос`

```SQL
SELECT h.hobby_name as hobby, h.risk, 12*extract( days from (NOW ()-sh.started_at)) as doing, stud.n_z
FROM student stud
INNER JOIN student_hobby sh ON stud.n_z = sh.student_id
INNER JOIN hobby h ON h.id = sh.hobby_id
WHERE sh.finished_at IS NULL and stud.n_z=1
ORDER BY sh.started_at
```
### у меня выдало 2 строки, но можно  можно прописать Limit 1 в конце
#### `Вывод`

![sql7](sql_pict/sql7.png)

<br></br>

### <a name="3_8"></a> 8. Найти все хобби, которыми увлекаются студенты, имеющие максимальный балл.

#### `Запрос`

```SQL
SELECT 	h.hobby_name, max(stud.score) max_score
FROM 	student stud, hobby h, student_hobby sh
WHERE 	h.id= sh.hobby_id and 
      	stud.n_z= sh.student_id
GROUP BY h.hobby_name
```
### у меня мой запрос как-то криво работал
### поэтому я пока редактировал readme посмотрел как саня сделал
### но изменил под свои реали и всё нормально заработало
#### `Вывод`

![sql8](sql_pict/sql8.png)

<br></br>

### <a name="3_9"></a> 9. Найти все действующие хобби, которыми увлекаются троечники 2-го курса.

#### `Запрос`

### В теории должно работать
### но у меня просто нет троечников на 2 курсе
### Вывод: второкурсники-умные

```SQL
Ну вот что получилось просто у второкурсников
SELECT h.hobby_name as hobby
FROM hobby h
INNER JOIN
student_hobby sh on h.id = sh.hobby_id
INNER JOIN (SELECT stud.n_z
FROM student stud
WHERE stud.score=3 and n_group/1000=2)  stud on stud.n_z=sh.student_id
WHERE sh.finished_at IS NULL

```
### Ну вот что получилось просто у второкурсников
'''SQL
SELECT h.hobby_name as hobby
FROM hobby h
INNER JOIN
student_hobby sh on h.id = sh.hobby_id
INNER JOIN (SELECT stud.n_z
FROM student stud
WHERE stud.score<6 and n_group/1000=2)  stud on stud.n_z=sh.student_id
WHERE sh.finished_at IS NULL
'''
#### `Вывод`

![sql9](sql_pict/sql9.png)

<br></br>

### <a name="3_10"></a> 10. Найти номера курсов, на которых более 50% студентов имеют более одного действующего хобби.

### Взял у Паши, но он мне на паре объяснил что да как
### По итогу я забыл  как всё это работает
#### `Запрос`
```SQL
SELECT course_act.course
FROM
(SELECT course, COUNT(DISTINCT sh.student_id )as zanim
FROM student_hobby sh
INNER JOIN (
SELECT DISTINCT n_group/1000 as course, st.n_z
FROM student st) as nt on nt.n_z = sh.student_id
WHERE finished_at IS NULL
GROUP BY course) as course_act
RIGHT JOIN
(SELECT n_group/1000 as course, COUNT(*) from student st GROUP BY n_group/1000) as course_all 
on course_act.course = course_all.course
WHERE course_act.zanim*1./course_all.count>0.5
```

#### `Вывод`

![sql10](sql_pict/sql10.png)

<br></br>




